<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>DataExplorer.EfCore </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="DataExplorer.EfCore ">
    <meta name="generator" content="docfx ">
  
    <link rel="shortcut icon" href="../favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <link rel="stylesheet" href="../styles/colors.css">
    <link rel="stylesheet" href="../styles/discord.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
  
  
  
  </head>
  <body>
        <div class="top-navbar">

            <a class="burger-icon" onclick="toggleMenu()">
                <svg name="Hamburger" style="vertical-align: middle;" width="24" height="24" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M20 6H4V9H20V6ZM4 10.999H20V13.999H4V10.999ZM4 15.999H20V18.999H4V15.999Z"></path></svg>
            </a>


            <a class="brand" href="../index.html">
              <img src="../logo.svg" alt="" class="logomark">
              <span class="brand-title"></span>
            </a>
        </div>

        <div class="body-content">

            <div id="blackout" class="blackout" onclick="toggleMenu()"></div>

            <nav id="sidebar" role="navigation">

                <div class="sidebar">
                    

                    <div>
                      <div class="mobile-hide">

                        <a class="brand" href="../index.html">
                          <img src="../logo.svg" alt="" class="logomark">
                          <span class="brand-title"></span>
                        </a>                      </div>


                      <div id="navbar">
                      </div>

                    </div>


                    <div class="sidebar-item-separator"></div>


                        <div id="sidetoggle">
                          <div id="sidetoc"></div>
                        </div>

                </div>

                <div class="footer">
  
  <span>Generated by <strong>DocFX</strong></span>
                </div>
            </nav>

            <main class="main-panel">


                <div role="main" class="main-panel-content hide-when-search">


                        <div class="subnav navbar navbar-default">
                          <div class="container hide-when-search" id="breadcrumb">
                            <ul class="breadcrumb">
                              <li></li>
                            </ul>
                          </div>
                        </div>

                    <article class="content wrap" id="_content" data-uid="">
<h1 id="dataexplorerefcore">DataExplorer.EfCore</h1>

<p><a href="https://github.com/MikyM/DataExplorer/actions"><img src="https://github.com/MikyM/DataExplorer/actions/workflows/release.yml/badge.svg" alt="Build Status"></a></p>
<p>Library featuring an opinionated, reusable data access layer offering abstractions and implementations for SQL storages (EF Core) and MongoDb (MongoDb.Entities).</p>
<h2 id="installation">Installation</h2>
<p>Base DataExplorer package is required.</p>
<p>To register the library services with the DI container use the DataExplorerConfiguration extension method provided by the library:</p>
<pre><code class="lang-csharp">builder.AddDataExplorer(options =&gt; 
{
    options.AddEfCore(assembliesToScan);
});
</code></pre>
<h2 id="description">Description</h2>
<p>Library provides definition of a base entity (with generic Id and with long Id) which should be inherited by any entity defined within application's domain.</p>
<pre><code class="lang-csharp">public class CustomEntity : Entity&lt;long&gt;
{
    public bool CustomField { get; set; }
}
</code></pre>
<p>Library supports soft deletion via a <code>IsDisabled</code> property on entities, you can mark an entity as a soft deleted entity using <code>IDisableableEntity</code> interface.
Snowflake IDs are supported using an IdGenerator, to mark an entity to use snowflake IDs inherit from <code>SnowflakeEntity</code> or implement <code>ISnowflakeEntity</code> interface and override the Id property. Ids can be generated by a provided <code>IdGenerator</code> which you can add as a singleton service via <code>AddIdGen()</code></p>
<p>To avoid LINQ boilerplate a specification pattern is used to encapsulate query logic and should be used like so:</p>
<pre><code class="lang-csharp">public CustomSpecification : ISpecification&lt;CustomEntity&gt;
{
    public CustomSpecification(bool customField)
    {
        Where(x =&gt; x.CustomField == customField);
    }
}
</code></pre>
<p>Please use IntelliSense to check for available methods but pretty much everything should be supported by now.</p>
<p>Every data service automatically grabs it's corresponding entity repository from the Unit of Work and exposes it via properties, you can however do anything and everything through exposed DbContext, UnitOfWork, Mapper and other properties.</p>
<p>Getting a repository is done through methods on <code>IUnitOfWork</code>:</p>
<pre><code class="lang-csharp">unitOfWork.GetRepository&lt;IRepository&lt;CustomEntity&gt;&gt;();
</code></pre>
<p>Please use IntelliSense to find other helpful get repo methods. You can't (without reflection magic) create custom repository implementations, their constructor is internal, you can only get generic repos with the methods exposed via <code>IUnitOfWork</code>, any custom, additional logic, should be performed in the service layer.:</p>
<p>Given below context definitions (always abstract your own context) - either manually register your context interface as a service or use <code>AddDbContext</code> methods on <code>DataExplorerEfCoreConfiguration</code>.</p>
<pre><code class="lang-csharp">public interface ICustomDbContext : IEfDbContext
{
}

public class CustomDbContext : EfDbContext, ICustomDbContext
{
}
</code></pre>
<p>You can define a crud data service like so to add some custom logic:</p>
<pre><code class="lang-csharp">public interface ICustomDataService : ICrudDataService&lt;CustomEntity, ICustomDbContext&gt;
{
    Task&lt;Result&gt; GetFirstEntityWithCustomFieldTrueAndPerformLogicAsync();
}

public class CustomDataService : CrudDataService&lt;CustomEntity, ICustomDbContext&gt;, ICustomDataService
{
    public async Task&lt;Result&gt; GetFirstEntityWithCustomFieldTrueAndPerformLogicAsync()
    {
        var entityRes = await GetSingleBySpecAsync(new CustomSpecification(true));

        if (!entityRes.IsDefined(out var entity))
            return entityRes;

        /// perform custom logic on entity or whatnot

        return Result.FromSuccess();
    }
}
</code></pre>
<p>You can also simply inject a generic data service to perform simple operations like so:</p>
<pre><code class="lang-csharp">
public class CustomController : ControllerBase
{
    private readonly IReadOnlyDataService&lt;CustomEntity,ICustomDbContext&gt; _dataService;

    public CustomController(IReadOnlyDataService&lt;CustomEntity,ICustomDbContext&gt; dataService)
        =&gt; _dataService = dataService;

    [HttpGet]
    public async Task&lt;IActionResult&gt; GetAllByCustomFieldAsync(bool customField)
    {
        var subRes = await _dataService.GetBySpecAsync(new CustomSpecification(customField)); // or GetBySpecAsync&lt;SomeDto&gt; to automatically map the entity using AutoMapper
        if (!subRes.IsDefined(out var result))
            return BadRequest();

        return Ok(result);
    }
}
</code></pre>
<p>All service methods should return a <a href="https://github.com/Remora/Remora.Results">Result</a> struct which determines whether the operation succeeded or not and returns additional objects if necessary and shouldn't throw exceptions unless absolutely necessary.</p>
</article>
              
                </div>
            </main>
        </div>


        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
        <script type="text/javascript" src="../styles/jquery.twbsPagination.js"></script>
        <script type="text/javascript" src="../styles/url.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>
        <script type="text/javascript" src="../styles/docfx.js"></script>
        <script type="text/javascript" src="../styles/main.js"></script>
    </body>

</html>
